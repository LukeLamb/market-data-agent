apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: market-data-agent-base
  annotations:
    config.kubernetes.io/local-config: "true"

namespace: market-data-agent

resources:
  - namespace.yaml
  - serviceaccount.yaml
  - configmap.yaml
  - secret.yaml
  - pvc.yaml
  - deployment.yaml
  - service.yaml

commonLabels:
  app.kubernetes.io/name: market-data-agent
  app.kubernetes.io/part-of: market-data-platform
  app.kubernetes.io/managed-by: kustomize

images:
  - name: market-data-agent
    newTag: latest

configMapGenerator:
  - name: market-data-agent-env
    literals:
      - ENVIRONMENT=production
      - LOG_LEVEL=INFO
      - WORKERS=4

secretGenerator:
  - name: market-data-agent-generated
    literals:
      - generated-secret=placeholder

replicas:
  - name: market-data-agent
    count: 3

patches:
  - target:
      kind: Deployment
      name: market-data-agent
    patch: |-
      - op: add
        path: /spec/template/metadata/annotations/deployment.kubernetes.io~1revision
        value: "1"